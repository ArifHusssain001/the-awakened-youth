<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - The Awakened Youth</title>
    <link rel="icon" type="image/png" sizes="32x32" href="images/logo.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/logo.png">
    <link rel="apple-touch-icon" sizes="180x180" href="images/logo.png">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="pages.css">
    <style>
        /* Full Width Header for Admin Page */
        .header .container {
            max-width: 100%;
            padding: 0 30px;
        }
        
        .header-top {
            width: 100%;
        }
        
        .navigation {
            width: 100%;
        }
        
        /* Ensure Logo is Visible */
        .site-logo {
            width: 120px !important;
            height: auto !important;
            max-height: 60px !important;
            display: block !important;
            background: transparent !important;
        }
        
        .logo {
            display: flex !important;
            align-items: center !important;
            gap: 15px !important;
        }
        
        .site-title {
            color: #330066 !important;
            font-size: 1.8rem !important;
            display: block !important;
        }
        .admin-login-section {
            max-width: 400px;
            margin: 50px auto;
            background: #FFFFFF;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 2px solid #E6E6FF;
        }
        
        .admin-dashboard {
            display: none;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .admin-header {
            background: linear-gradient(135deg, #330066, #663399);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .admin-card {
            background: #F5F0FF;
            padding: 25px;
            border-radius: 10px;
            border: 1px solid #E6E6FF;
        }
        
        /* Enhanced Admin Dashboard Styles */
        .admin-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #663399, #7B68EE);
            color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(102, 51, 153, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(102, 51, 153, 0.3);
        }
        
        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 10px 0;
            animation: countUp 1s ease;
        }
        
        @keyframes countUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .quick-actions {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }
        
        .quick-action-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #663399, #7B68EE);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(102, 51, 153, 0.3);
            transition: all 0.3s ease;
        }
        
        .quick-action-btn:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 6px 30px rgba(102, 51, 153, 0.5);
        }
        
        .activity-feed {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-top: 30px;
        }
        
        .activity-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.3s ease;
        }
        
        .activity-item:hover {
            background: #f8f6ff;
        }
        
        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #663399, #7B68EE);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .activity-content {
            flex: 1;
        }
        
        .activity-time {
            color: #999;
            font-size: 0.85rem;
        }
        
        .admin-card h3 {
            color: #330066;
            margin-bottom: 15px;
        }
        
        .admin-btn {
            background: #663399;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin: 5px 5px 5px 0;
            font-weight: 500;
        }
        
        .admin-btn:hover {
            background: #330066;
        }
        
        .admin-btn.secondary {
            background: #E6E6FF;
            color: #330066;
        }
        
        .admin-btn.danger {
            background: #d32f2f;
        }
        
        .editor-section {
            display: none;
            background: #F9F9F9;
            padding: 30px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .editor-toolbar {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .toolbar-btn {
            padding: 8px 12px;
            border: 1px solid #E6E6FF;
            background: white;
            cursor: pointer;
            border-radius: 3px;
            font-size: 0.9rem;
        }
        
        .toolbar-btn:hover {
            background: #F5F0FF;
        }
        
        .editor-textarea {
            width: 100%;
            min-height: 300px;
            padding: 15px;
            border: 2px solid #E6E6FF;
            border-radius: 5px;
            font-family: inherit;
            font-size: 1rem;
            line-height: 1.6;
        }
        
        .columns-list {
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .column-item {
            padding: 20px;
            border-bottom: 1px solid #E6E6FF;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .column-item:last-child {
            border-bottom: none;
        }
        
        .column-info h4 {
            color: #330066;
            margin-bottom: 5px;
        }
        
        .column-meta {
            color: #666;
            font-size: 0.9rem;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-published {
            background: #e8f5e8;
            color: #2e7d32;
        }
        
        .status-draft {
            background: #fff3e0;
            color: #f57c00;
        }
        
        .preview-section {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-top: 20px;
            border: 1px solid #E6E6FF;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-top">
                <a href="index.html" class="logo" title="The Awakened Youth - Home">
                    <img src="images/logo.png" alt="The Awakened Youth logo" class="site-logo">
                    <h1 class="site-title">The Awakened Youth</h1>
                </a>
                <div class="search-container">
                    <div class="search-bar">
                        <input type="text" class="search-input" placeholder="Search columns, content..." id="searchInput">
                        <button class="search-btn" onclick="performSearch()" type="button">
                            <svg class="search-icon" viewBox="0 0 24 24">
                                <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                            </svg>
                        </button>
                        <div class="search-results" id="searchResults"></div>
                    </div>
                </div>
                <button id="themeToggle" class="theme-toggle" aria-label="Toggle theme" type="button" title="Toggle light / dark">üåô</button>
                
                <!-- Notification Bell -->
                <div class="notification-container">
                    <button id="notificationsButton" class="notification-bell" aria-haspopup="true" aria-expanded="false" aria-label="Notifications">
                        üîî
                        <span id="notificationsBadge" class="notification-badge" style="display:none"></span>
                    </button>
                    <div id="notificationsDropdown" class="notifications-dropdown" role="region" aria-hidden="true">
                        <div class="notifications-header">
                            <strong>Notifications</strong>
                            <div class="notifications-actions">
                                <button id="markAllReadBtn" type="button">Mark all read</button>
                            </div>
                        </div>
                        <ul id="notificationsList" class="notifications-list"></ul>
                    </div>
                </div>
            </div>
            <nav class="navigation">
                <ul class="main-nav-links">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="about.html">About Me</a></li>
                    <li><a href="columns.html">Columns</a></li>
                    <li><a href="contact.html">Contact Me</a></li>
                    <li><a href="feedback.html">Feedback & Questions</a></li>
                    <li><a href="admin.html" class="active">Admin</a></li>
                    <li id="authLinks">
                        <a href="login.html" style="color: #663399; margin-right: 15px;">Login</a>
                        <a href="register.html" style="background: #663399; color: white; padding: 6px 12px; border-radius: 4px; text-decoration: none;">Register</a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section class="page-header">
            <div class="container">
                <h2 class="page-title">Admin Panel</h2>
            </div>
        </section>

        <section class="content-section">
            <div class="container">
                <!-- Login Section -->
                <div id="loginSection" class="admin-login-section">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h3 style="color: #330066; margin-bottom: 10px;">Admin Login</h3>
                        <p style="color: #666;">Enter your credentials to access the admin panel</p>
                    </div>
                    
                    <form id="adminLoginForm">
                        <div class="form-group">
                            <label for="adminUsername">Username:</label>
                            <input type="text" id="adminUsername" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="adminPassword">Password:</label>
                            <input type="password" id="adminPassword" required>
                        </div>
                        
                        <button type="submit" class="admin-btn" style="width: 100%;">Login to Admin Panel</button>
                        
                        <div id="loginError" style="display: none; color: #d32f2f; text-align: center; margin-top: 15px;">
                            Invalid credentials. Please try again.
                        </div>
                    </form>
                    
                    <div style="background: #F5F0FF; padding: 15px; border-radius: 5px; margin-top: 20px; font-size: 0.9rem;">
                        <strong>Default Credentials:</strong><br>
                        Username: <code>admin</code><br>
                        Password: <code>awakened2024</code>
                    </div>
                </div>

                <!-- Admin Dashboard -->
                <div id="adminDashboard" class="admin-dashboard">
                    <div class="admin-header">
                        <h2>Welcome to Admin Dashboard</h2>
                        <p>Manage your columns and website content</p>
                        <button onclick="logout()" class="admin-btn secondary" style="margin-top: 10px;">Logout</button>
                    </div>

                    <!-- Analytics Stats Cards -->
                    <div class="admin-stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">üëÅÔ∏è</div>
                            <div class="stat-number" id="totalViews">1,247</div>
                            <div class="stat-label">Total Views</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üìù</div>
                            <div class="stat-number" id="totalPosts">0</div>
                            <div class="stat-label">Total Columns</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üë•</div>
                            <div class="stat-number" id="totalUsers">5</div>
                            <div class="stat-label">Active Users</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üí¨</div>
                            <div class="stat-number" id="totalComments">23</div>
                            <div class="stat-label">Comments</div>
                        </div>
                    </div>

                    <div class="admin-grid">
                        <div class="admin-card">
                            <h3>üìù Write New Column</h3>
                            <p>Create and publish new columns for your website.</p>
                            <button onclick="showEditor()" class="admin-btn">Write New Column</button>
                        </div>

                        <div class="admin-card">
                            <h3>üìö Manage Columns</h3>
                            <p>View, edit, and manage all your published columns.</p>
                            <button onclick="showColumns()" class="admin-btn">View All Columns</button>
                        </div>

                        <div class="admin-card">
                            <h3>üìã Review Submissions</h3>
                            <p>Review and approve submissions from contributors.</p>
                            <button onclick="showSubmissions()" class="admin-btn">Review Submissions</button>
                            <div style="margin-top: 10px;">
                                <span id="pendingSubmissionsCount" style="background: #ff9800; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem;">0 Pending</span>
                            </div>
                        </div>

                        <div class="admin-card">
                            <h3>üë• Manage Users</h3>
                            <p>View and manage registered contributors.</p>
                            <button onclick="showUsers()" class="admin-btn">Manage Users</button>
                        </div>

                        <div class="admin-card">
                            <h3>üìä Statistics</h3>
                            <div style="margin: 15px 0;">
                                <div>Total Columns: <strong id="totalColumns">0</strong></div>
                                <div>Published: <strong id="publishedCount">0</strong></div>
                                <div>Drafts: <strong id="draftCount">0</strong></div>
                            </div>
                        </div>

                        <div class="admin-card">
                            <h3>üåê Website</h3>
                            <p>Quick links to your website pages.</p>
                            <a href="index.html" class="admin-btn secondary">View Website</a>
                            <a href="columns.html" class="admin-btn secondary">View Columns</a>
                        </div>
                    </div>

                    <!-- Recent Activity Feed -->
                    <div class="activity-feed">
                        <h3 style="color: #330066; margin-bottom: 20px;">üìã Recent Activity</h3>
                        <div class="activity-item">
                            <div class="activity-icon">‚úçÔ∏è</div>
                            <div class="activity-content">
                                <strong>New column published</strong>
                                <div class="activity-time">2 hours ago</div>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon">üë§</div>
                            <div class="activity-content">
                                <strong>New user registered</strong>
                                <div class="activity-time">5 hours ago</div>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon">üí¨</div>
                            <div class="activity-content">
                                <strong>New comment received</strong>
                                <div class="activity-time">1 day ago</div>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon">‚≠ê</div>
                            <div class="activity-content">
                                <strong>Column rated 5 stars</strong>
                                <div class="activity-time">2 days ago</div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions Button -->
                    <div class="quick-actions">
                        <button class="quick-action-btn" onclick="showEditor()" title="Quick Write">
                            ‚úçÔ∏è
                        </button>
                    </div>

                    <!-- Column Editor -->
                    <div id="editorSection" class="editor-section">
                        <h3 style="color: #330066; margin-bottom: 20px;">‚úçÔ∏è Write New Column</h3>
                        
                        <form id="columnForm">
                            <div class="form-group">
                                <label for="columnTitle">Column Title:</label>
                                <input type="text" id="columnTitle" placeholder="Enter your column title..." required>
                            </div>

                            <div class="form-group">
                                <label for="columnContent">Column Content:</label>
                                <div class="editor-toolbar">
                                    <button type="button" class="toolbar-btn" onclick="formatText('bold')"><strong>B</strong></button>
                                    <button type="button" class="toolbar-btn" onclick="formatText('italic')"><em>I</em></button>
                                    <button type="button" class="toolbar-btn" onclick="insertHeading()">H1</button>
                                    <button type="button" class="toolbar-btn" onclick="insertHeading('h2')">H2</button>
                                    <button type="button" class="toolbar-btn" onclick="insertHeading('h3')">H3</button>
                                    <button type="button" class="toolbar-btn" onclick="insertQuote()">Quote</button>
                                    <button type="button" class="toolbar-btn" onclick="insertList()">List</button>
                                    <button type="button" class="toolbar-btn" onclick="insertLink()">Link</button>
                                </div>
                                <textarea id="columnContent" class="editor-textarea" placeholder="Write your inspiring column content here...

You can use simple formatting:
- **Bold text**
- *Italic text*  
- # Heading 1
- ## Heading 2
- ### Heading 3
- > Quote text
- - List item
- [Link text](URL)

Start writing..." required></textarea>
                            </div>

                            <div style="display: flex; gap: 15px; margin-top: 20px;">
                                <button type="button" onclick="saveDraft()" class="admin-btn secondary">Save as Draft</button>
                                <button type="button" onclick="previewColumn()" class="admin-btn secondary">Preview</button>
                                <button type="submit" class="admin-btn">Publish Column</button>
                                <button type="button" onclick="hideEditor()" class="admin-btn secondary">Cancel</button>
                            </div>
                        </form>

                        <!-- Preview Section -->
                        <div id="previewSection" class="preview-section">
                            <h3 style="color: #330066; margin-bottom: 20px;">üìñ Preview</h3>
                            <div id="previewTitle" style="font-size: 1.5rem; color: #330066; margin-bottom: 15px;"></div>
                            <div id="previewContent" style="line-height: 1.8;"></div>
                            <button onclick="hidePreview()" class="admin-btn secondary" style="margin-top: 20px;">Hide Preview</button>
                        </div>
                    </div>

                    <!-- Columns Management -->
                    <div id="columnsSection" class="editor-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="color: #330066;">üìö Manage Columns</h3>
                            <button onclick="hideColumns()" class="admin-btn secondary">Close</button>
                        </div>
                        
                        <div id="columnsList" class="columns-list">
                            <!-- Columns will be loaded here -->
                        </div>
                    </div>

                    <!-- Submissions Management -->
                    <div id="submissionsSection" class="editor-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="color: #330066;">üìã Review Submissions</h3>
                            <div>
                                <select id="submissionStatusFilter" onchange="filterSubmissions()" style="padding: 8px; border: 1px solid #E6E6FF; border-radius: 4px; margin-right: 10px;">
                                    <option value="all">All Submissions</option>
                                    <option value="pending">Pending Review</option>
                                    <option value="approved">Approved</option>
                                    <option value="rejected">Rejected</option>
                                    <option value="draft">Drafts</option>
                                </select>
                                <button onclick="hideSubmissions()" class="admin-btn secondary">Close</button>
                            </div>
                        </div>
                        
                        <div id="submissionsList" class="columns-list">
                            <!-- Submissions will be loaded here -->
                        </div>
                    </div>

                    <!-- Users Management -->
                    <div id="usersSection" class="editor-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="color: #330066;">üë• Manage Users</h3>
                            <button onclick="hideUsers()" class="admin-btn secondary">Close</button>
                        </div>
                        
                        <div id="usersList" class="columns-list">
                            <!-- Users will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- legacy footer removed; site-wide footer injected by js/footer.js -->

    <script src="js/notification-fix.js"></script>
    <script src="js/columns-manager.js"></script>
    <script src="js/search.js"></script>
    <script src="js/submissions.js"></script>
    <script src="js/features.js"></script>
    <script>
        // Check if already logged in
        document.addEventListener('DOMContentLoaded', function() {
            const isLoggedIn = localStorage.getItem('adminLoggedIn');
            if (isLoggedIn) {
                showDashboard();
            }
            updateStats();
        });

        // Login functionality
        document.getElementById('adminLoginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;
            
            if (username === 'admin' && password === 'awakened2024') {
                localStorage.setItem('adminLoggedIn', 'true');
                localStorage.setItem('loginTime', new Date().getTime());
                showDashboard();
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        });

        function showDashboard() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'block';
            updateStats();
        }

        function logout() {
            localStorage.removeItem('adminLoggedIn');
            localStorage.removeItem('loginTime');
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('adminDashboard').style.display = 'none';
            hideEditor();
            hideColumns();
        }

        function updateStats() {
            const columns = JSON.parse(localStorage.getItem('columns') || '[]');
            const published = columns.filter(col => col.status === 'published').length;
            const drafts = columns.filter(col => col.status === 'draft').length;
            
            document.getElementById('totalColumns').textContent = columns.length;
            document.getElementById('publishedCount').textContent = published;
            document.getElementById('draftCount').textContent = drafts;

            // Update submission stats
            if (window.submissionSystem) {
                const stats = submissionSystem.getStatistics();
                const pendingCount = document.getElementById('pendingSubmissionsCount');
                if (pendingCount) {
                    pendingCount.textContent = `${stats.pending} Pending`;
                    pendingCount.style.display = stats.pending > 0 ? 'inline' : 'none';
                }
            }
        }

        // Editor functions
        function showEditor() {
            document.getElementById('editorSection').style.display = 'block';
            document.getElementById('columnsSection').style.display = 'none';
            document.getElementById('columnTitle').value = '';
            document.getElementById('columnContent').value = '';
        }

        function hideEditor() {
            document.getElementById('editorSection').style.display = 'none';
            hidePreview();
        }

        function showColumns() {
            document.getElementById('columnsSection').style.display = 'block';
            document.getElementById('editorSection').style.display = 'none';
            loadColumnsList();
        }

        function hideColumns() {
            document.getElementById('columnsSection').style.display = 'none';
        }

        function showSubmissions() {
            document.getElementById('submissionsSection').style.display = 'block';
            document.getElementById('editorSection').style.display = 'none';
            document.getElementById('columnsSection').style.display = 'none';
            document.getElementById('usersSection').style.display = 'none';
            loadSubmissionsList();
        }

        function hideSubmissions() {
            document.getElementById('submissionsSection').style.display = 'none';
        }

        function showUsers() {
            document.getElementById('usersSection').style.display = 'block';
            document.getElementById('editorSection').style.display = 'none';
            document.getElementById('columnsSection').style.display = 'none';
            document.getElementById('submissionsSection').style.display = 'none';
            loadUsersList();
        }

        function hideUsers() {
            document.getElementById('usersSection').style.display = 'none';
        }

        // Formatting functions
        function formatText(command) {
            const textarea = document.getElementById('columnContent');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            
            let formattedText = '';
            switch(command) {
                case 'bold':
                    formattedText = `**${selectedText}**`;
                    break;
                case 'italic':
                    formattedText = `*${selectedText}*`;
                    break;
            }
            
            textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
            textarea.focus();
        }

        function insertHeading(level = 'h1') {
            const textarea = document.getElementById('columnContent');
            const start = textarea.selectionStart;
            const prefix = level === 'h1' ? '# ' : level === 'h2' ? '## ' : '### ';
            
            textarea.value = textarea.value.substring(0, start) + prefix + textarea.value.substring(start);
            textarea.focus();
        }

        function insertQuote() {
            const textarea = document.getElementById('columnContent');
            const start = textarea.selectionStart;
            textarea.value = textarea.value.substring(0, start) + '> ' + textarea.value.substring(start);
            textarea.focus();
        }

        function insertList() {
            const textarea = document.getElementById('columnContent');
            const start = textarea.selectionStart;
            textarea.value = textarea.value.substring(0, start) + '- ' + textarea.value.substring(start);
            textarea.focus();
        }

        function insertLink() {
            const textarea = document.getElementById('columnContent');
            const start = textarea.selectionStart;
            textarea.value = textarea.value.substring(0, start) + '[Link text](URL)' + textarea.value.substring(start);
            textarea.focus();
        }

        // Preview functionality
        function previewColumn() {
            const title = document.getElementById('columnTitle').value;
            const content = document.getElementById('columnContent').value;
            
            if (!title || !content) {
                alert('Please fill in both title and content before previewing.');
                return;
            }
            
            document.getElementById('previewTitle').textContent = title;
            document.getElementById('previewContent').innerHTML = convertToHTML(content);
            document.getElementById('previewSection').style.display = 'block';
        }

        function hidePreview() {
            document.getElementById('previewSection').style.display = 'none';
        }

        // Convert markdown to HTML
        function convertToHTML(text) {
            return text
                .replace(/### (.*$)/gim, '<h3 style="color: #330066; margin: 20px 0 10px;">$1</h3>')
                .replace(/## (.*$)/gim, '<h2 style="color: #330066; margin: 25px 0 15px;">$1</h2>')
                .replace(/# (.*$)/gim, '<h1 style="color: #330066; margin: 30px 0 20px;">$1</h1>')
                .replace(/\*\*(.*?)\*\*/gim, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/gim, '<em>$1</em>')
                .replace(/> (.*$)/gim, '<blockquote style="border-left: 4px solid #663399; padding-left: 20px; margin: 20px 0; font-style: italic; color: #330066;">$1</blockquote>')
                .replace(/^- (.*$)/gim, '<li style="margin: 5px 0;">$1</li>')
                .replace(/\[([^\]]+)\]\(([^)]+)\)/gim, '<a href="$2" style="color: #663399; text-decoration: underline;">$1</a>')
                .replace(/\n\n/gim, '</p><p style="margin: 15px 0;">')
                .replace(/\n/gim, '<br>')
                .replace(/^(.)/gim, '<p style="margin: 15px 0;">$1')
                .replace(/(.)$/gim, '$1</p>');
        }

        // Save and publish functions
        function saveDraft() {
            saveColumn('draft');
        }

        function saveColumn(status) {
            const title = document.getElementById('columnTitle').value;
            const content = document.getElementById('columnContent').value;
            
            if (!title || !content) {
                alert('Please fill in both title and content.');
                return;
            }
            
            const column = {
                id: Date.now().toString(),
                title: title,
                content: content,
                status: status,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            const columns = JSON.parse(localStorage.getItem('columns') || '[]');
            columns.push(column);
            localStorage.setItem('columns', JSON.stringify(columns));
            
            // Create notification for new column
            createNotification(
                status === 'published' ? 'Column Published Successfully!' : 'Column Saved as Draft',
                `"${title}" has been ${status === 'published' ? 'published' : 'saved as draft'}. column-id:${column.id}`,
                'column'
            );
            
            // Update website if published
            if (status === 'published') {
                window.columnsManager.loadPublishedColumns();
                // Trigger statistics update
                document.dispatchEvent(new CustomEvent('columnsUpdated'));
            }
            
            alert(`Column ${status === 'published' ? 'published' : 'saved as draft'} successfully!`);
            hideEditor();
            updateStats();
        }

        // Form submission
        document.getElementById('columnForm').addEventListener('submit', function(e) {
            e.preventDefault();
            saveColumn('published');
        });

        // Load columns list
        function loadColumnsList() {
            const columns = JSON.parse(localStorage.getItem('columns') || '[]');
            const container = document.getElementById('columnsList');
            
            if (columns.length === 0) {
                container.innerHTML = '<div style="padding: 40px; text-align: center; color: #666;">No columns found. <button onclick="showEditor()" class="admin-btn">Write your first column</button></div>';
                return;
            }
            
            columns.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            container.innerHTML = columns.map(column => `
                <div class="column-item">
                    <div class="column-info">
                        <h4>${column.title}</h4>
                        <div class="column-meta">
                            Created: ${new Date(column.createdAt).toLocaleDateString()} | 
                            <span class="status-badge status-${column.status}">${column.status.toUpperCase()}</span>
                        </div>
                    </div>
                    <div>
                        <button onclick="editColumn('${column.id}')" class="admin-btn secondary">Edit</button>
                        ${column.status === 'draft' ? 
                            `<button onclick="publishColumn('${column.id}')" class="admin-btn">Publish</button>` : 
                            `<button onclick="unpublishColumn('${column.id}')" class="admin-btn secondary">Unpublish</button>`
                        }
                        <button onclick="deleteColumn('${column.id}')" class="admin-btn danger">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function editColumn(id) {
            const columns = JSON.parse(localStorage.getItem('columns') || '[]');
            const column = columns.find(col => col.id === id);
            
            if (column) {
                document.getElementById('columnTitle').value = column.title;
                document.getElementById('columnContent').value = column.content;
                showEditor();
                
                // Update form to edit mode
                document.getElementById('columnForm').onsubmit = function(e) {
                    e.preventDefault();
                    updateColumn(id);
                };
            }
        }

        function updateColumn(id) {
            const title = document.getElementById('columnTitle').value;
            const content = document.getElementById('columnContent').value;
            
            if (!title || !content) {
                alert('Please fill in both title and content.');
                return;
            }
            
            const columns = JSON.parse(localStorage.getItem('columns') || '[]');
            const columnIndex = columns.findIndex(col => col.id === id);
            
            if (columnIndex !== -1) {
                columns[columnIndex].title = title;
                columns[columnIndex].content = content;
                columns[columnIndex].updatedAt = new Date().toISOString();
                localStorage.setItem('columns', JSON.stringify(columns));
                
                // Create notification for edit
                createNotification(
                    'Column Updated',
                    `"${title}" has been updated successfully.`,
                    'edit'
                );
                
                if (columns[columnIndex].status === 'published') {
                    window.columnsManager.loadPublishedColumns();
                }
                
                alert('Column updated successfully!');
                hideEditor();
                updateStats();
                loadColumnsList();
                
                // Reset form
                document.getElementById('columnForm').onsubmit = function(e) {
                    e.preventDefault();
                    saveColumn('published');
                };
            }
        }

        function publishColumn(id) {
            const columns = JSON.parse(localStorage.getItem('columns') || '[]');
            const columnIndex = columns.findIndex(col => col.id === id);
            
            if (columnIndex !== -1) {
                columns[columnIndex].status = 'published';
                columns[columnIndex].updatedAt = new Date().toISOString();
                localStorage.setItem('columns', JSON.stringify(columns));
                
                // Create notification for publish
                createNotification(
                    'üì¢ Column Published!',
                    `"${columns[columnIndex].title}" is now live on your website. column-id:${columns[columnIndex].id}`,
                    'publish'
                );
                
                window.columnsManager.loadPublishedColumns();
                
                alert('Column published successfully!');
                updateStats();
                loadColumnsList();
            }
        }

        function unpublishColumn(id) {
            const columns = JSON.parse(localStorage.getItem('columns') || '[]');
            const columnIndex = columns.findIndex(col => col.id === id);
            
            if (columnIndex !== -1) {
                columns[columnIndex].status = 'draft';
                columns[columnIndex].updatedAt = new Date().toISOString();
                localStorage.setItem('columns', JSON.stringify(columns));
                
                window.columnsManager.loadPublishedColumns();
                
                alert('Column unpublished successfully!');
                updateStats();
                loadColumnsList();
            }
        }

        function deleteColumn(id) {
            if (confirm('Are you sure you want to delete this column? This action cannot be undone.')) {
                const columns = JSON.parse(localStorage.getItem('columns') || '[]');
                const deletedColumn = columns.find(col => col.id === id);
                const filteredColumns = columns.filter(col => col.id !== id);
                localStorage.setItem('columns', JSON.stringify(filteredColumns));
                
                // Create notification for delete
                if (deletedColumn) {
                    createNotification(
                        'Column Deleted',
                        `"${deletedColumn.title}" has been removed.`,
                        'delete'
                    );
                }
                
                window.columnsManager.loadPublishedColumns();
                
                alert('Column deleted successfully!');
                updateStats();
                loadColumnsList();
            }
        }
    // Submissions Management Functions
        function loadSubmissionsList() {
            try {
                const submissions = submissionSystem.getAllSubmissions();
                const container = document.getElementById('submissionsList');
                
                if (submissions.length === 0) {
                    container.innerHTML = '<div style="padding: 40px; text-align: center; color: #666;">No submissions found.</div>';
                    return;
                }
                
                // Sort by creation date (newest first)
                submissions.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                
                container.innerHTML = submissions.map(submission => `
                    <div class="column-card" data-status="${submission.status}">
                        <h3>${submission.title}</h3>
                        <div class="column-meta">
                            Author: ${submission.authorName} (${submission.authorEmail})<br>
                            Submitted: ${new Date(submission.createdAt).toLocaleDateString()} | 
                            Status: <span style="color: ${getStatusColor(submission.status)}; font-weight: 600;">${submission.status.toUpperCase()}</span>
                            ${submission.reviewedAt ? `<br>Reviewed: ${new Date(submission.reviewedAt).toLocaleDateString()} by ${submission.reviewedBy}` : ''}
                        </div>
                        <div class="column-snippet" style="color: #666; margin: 10px 0; font-size: 0.9rem;">
                            ${submission.content.substring(0, 150)}${submission.content.length > 150 ? '...' : ''}
                        </div>
                        ${submission.adminFeedback ? `<div style="background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 4px; font-size: 0.9rem;"><strong>Admin Feedback:</strong> ${submission.adminFeedback}</div>` : ''}
                        <div class="column-actions">
                            <button onclick="viewSubmissionDetails('${submission.id}')" class="btn btn-secondary">View Full</button>
                            ${submission.status === 'pending' ? `
                                <button onclick="approveSubmission('${submission.id}')" class="btn btn-primary">Approve</button>
                                <button onclick="rejectSubmission('${submission.id}')" class="btn btn-danger">Reject</button>
                            ` : ''}
                            ${submission.status === 'approved' ? `
                                <button onclick="unpublishSubmission('${submission.id}')" class="btn btn-secondary">Unpublish</button>
                            ` : ''}
                            <button onclick="deleteSubmissionAdmin('${submission.id}')" class="btn btn-danger">Delete</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading submissions:', error);
            }
        }

        function getStatusColor(status) {
            const colors = {
                pending: '#ff9800',
                approved: '#4caf50',
                rejected: '#f44336',
                draft: '#9c27b0'
            };
            return colors[status] || '#666';
        }

        function filterSubmissions() {
            const filter = document.getElementById('submissionStatusFilter').value;
            const cards = document.querySelectorAll('#submissionsList .column-card');
            
            cards.forEach(card => {
                if (filter === 'all' || card.dataset.status === filter) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function viewSubmissionDetails(id) {
            const submission = submissionSystem.getSubmission(id);
            if (submission) {
                const content = convertToHTML(submission.content);
                const popup = window.open('', '_blank', 'width=800,height=600,scrollbars=yes');
                popup.document.write(`
                    <html>
                        <head>
                            <title>${submission.title} - Submission Details</title>
                            <style>
                                body { font-family: Arial, sans-serif; padding: 20px; line-height: 1.6; }
                                .header { border-bottom: 2px solid #330066; padding-bottom: 15px; margin-bottom: 20px; }
                                .title { color: #330066; font-size: 1.5rem; margin-bottom: 10px; }
                                .meta { color: #666; font-size: 0.9rem; }
                                .content { margin-top: 20px; }
                            </style>
                        </head>
                        <body>
                            <div class="header">
                                <div class="title">${submission.title}</div>
                                <div class="meta">
                                    Author: ${submission.authorName} (${submission.authorEmail})<br>
                                    Status: ${submission.status}<br>
                                    Submitted: ${new Date(submission.createdAt).toLocaleString()}
                                    ${submission.reviewedAt ? `<br>Reviewed: ${new Date(submission.reviewedAt).toLocaleString()} by ${submission.reviewedBy}` : ''}
                                </div>
                            </div>
                            <div class="content">${content}</div>
                        </body>
                    </html>
                `);
            }
        }

        function approveSubmission(id) {
            const feedback = prompt('Optional feedback for the author:');
            try {
                submissionSystem.updateSubmissionStatus(id, 'approved', feedback);
                alert('Submission approved and published!');
                loadSubmissionsList();
                updateStats();
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        function rejectSubmission(id) {
            const feedback = prompt('Please provide feedback for the author (required):');
            if (!feedback) {
                alert('Feedback is required when rejecting a submission.');
                return;
            }
            
            try {
                submissionSystem.updateSubmissionStatus(id, 'rejected', feedback);
                alert('Submission rejected with feedback sent to author.');
                loadSubmissionsList();
                updateStats();
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        function unpublishSubmission(id) {
            if (confirm('Are you sure you want to unpublish this submission?')) {
                try {
                    submissionSystem.updateSubmissionStatus(id, 'rejected', 'Unpublished by admin');
                    alert('Submission unpublished.');
                    loadSubmissionsList();
                    updateStats();
                } catch (error) {
                    alert('Error: ' + error.message);
                }
            }
        }

        function deleteSubmissionAdmin(id) {
            if (confirm('Are you sure you want to delete this submission? This action cannot be undone.')) {
                try {
                    submissionSystem.deleteSubmission(id);
                    alert('Submission deleted successfully!');
                    loadSubmissionsList();
                    updateStats();
                } catch (error) {
                    alert('Error: ' + error.message);
                }
            }
        }

        // Users Management Functions
        function loadUsersList() {
            try {
                const users = authSystem.getAllUsers();
                const container = document.getElementById('usersList');
                
                if (users.length === 0) {
                    container.innerHTML = '<div style="padding: 40px; text-align: center; color: #666;">No registered users found.</div>';
                    return;
                }
                
                // Sort by registration date (newest first)
                users.sort((a, b) => new Date(b.registeredAt) - new Date(a.registeredAt));
                
                container.innerHTML = users.map(user => `
                    <div class="column-card">
                        <h3>${user.name}</h3>
                        <div class="column-meta">
                            Email: ${user.email}<br>
                            Role: ${user.role}<br>
                            Registered: ${new Date(user.registeredAt).toLocaleDateString()}<br>
                            Status: <span style="color: ${user.status === 'active' ? '#4caf50' : '#f44336'}; font-weight: 600;">${user.status.toUpperCase()}</span>
                            ${user.lastLogin ? `<br>Last Login: ${new Date(user.lastLogin).toLocaleDateString()}` : '<br>Never logged in'}
                        </div>
                        <div class="column-actions">
                            ${user.status === 'active' ? 
                                `<button onclick="deactivateUser('${user.id}')" class="btn btn-secondary">Deactivate</button>` : 
                                `<button onclick="activateUser('${user.id}')" class="btn btn-primary">Activate</button>`
                            }
                            <button onclick="viewUserSubmissions('${user.id}')" class="btn btn-secondary">View Submissions</button>
                            <button onclick="deleteUser('${user.id}')" class="btn btn-danger">Delete User</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        function activateUser(userId) {
            try {
                authSystem.updateUserStatus(userId, 'active');
                alert('User activated successfully!');
                loadUsersList();
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        function deactivateUser(userId) {
            if (confirm('Are you sure you want to deactivate this user?')) {
                try {
                    authSystem.updateUserStatus(userId, 'inactive');
                    alert('User deactivated successfully!');
                    loadUsersList();
                } catch (error) {
                    alert('Error: ' + error.message);
                }
            }
        }

        function viewUserSubmissions(userId) {
            const submissions = submissionSystem.getUserSubmissions(userId);
            if (submissions.length === 0) {
                alert('This user has no submissions yet.');
                return;
            }
            
            const submissionsList = submissions.map(s => 
                `‚Ä¢ ${s.title} (${s.status}) - ${new Date(s.createdAt).toLocaleDateString()}`
            ).join('\n');
            
            alert(`User Submissions:\n\n${submissionsList}`);
        }

        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user? This will also delete all their submissions.')) {
                try {
                    // Delete user's submissions first
                    const submissions = submissionSystem.getUserSubmissions(userId);
                    submissions.forEach(submission => {
                        submissionSystem.deleteSubmission(submission.id);
                    });
                    
                    // Delete user
                    const users = JSON.parse(localStorage.getItem('users') || '[]');
                    const updatedUsers = users.filter(u => u.id !== userId);
                    localStorage.setItem('users', JSON.stringify(updatedUsers));
                    
                    alert('User and all their submissions deleted successfully!');
                    loadUsersList();
                    updateStats();
                } catch (error) {
                    alert('Error: ' + error.message);
                }
            }
        }
        
        // ============================================
        // CREATE NOTIFICATION
        // ============================================
        function createNotification(title, body, type = 'info') {
            console.log('üîî Creating notification:', title);
            
            // Use the same storage keys as notifications.js
            const STORAGE_KEY = 'aw_notifications';
            const UNREAD_KEY = 'aw_notifications_unread_ids';
            
            const notifications = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
            const unreadIds = JSON.parse(localStorage.getItem(UNREAD_KEY) || '[]');
            
            const notification = {
                id: `notif_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                title: title,
                body: body,
                type: type,
                createdAt: new Date().toISOString(),
                read: false
            };
            
            // Add to beginning of array (newest first)
            notifications.unshift(notification);
            unreadIds.push(notification.id);
            
            // Keep only last 20 notifications
            if (notifications.length > 20) {
                const removed = notifications.pop();
                // Remove from unread if it was there
                const index = unreadIds.indexOf(removed.id);
                if (index > -1) unreadIds.splice(index, 1);
            }
            
            // Save to localStorage
            localStorage.setItem(STORAGE_KEY, JSON.stringify(notifications));
            localStorage.setItem(UNREAD_KEY, JSON.stringify(unreadIds));
            
            console.log('‚úÖ Notification saved to localStorage');
            console.log('üìä Total notifications:', notifications.length);
            console.log('üìä Unread count:', unreadIds.length);
            
            // Force update the notification UI immediately
            setTimeout(() => {
                // Try to call the render function directly if available
                if (typeof window.renderNotifications === 'function') {
                    window.renderNotifications();
                }
                
                // Also dispatch event for good measure
                window.dispatchEvent(new CustomEvent('notificationsUpdated', {
                    detail: { notification: notification }
                }));
                
                // Update badge manually
                updateNotificationBadge(unreadIds.length);
            }, 100);
            
            // Show toast notification
            showToastNotification(title, body);
        }
        
        // Update notification badge
        function updateNotificationBadge(count) {
            const badge = document.getElementById('notificationsBadge');
            if (badge) {
                if (count > 0) {
                    badge.textContent = count > 99 ? '99+' : count;
                    badge.style.display = 'inline-block';
                } else {
                    badge.style.display = 'none';
                }
            }
        }
        
        // Show toast notification
        function showToastNotification(title, body) {
            const toast = document.createElement('div');
            toast.className = 'toast toast-success show';
            toast.innerHTML = `
                <div class="toast-content">
                    <span class="toast-icon">‚úì</span>
                    <div>
                        <strong>${title}</strong>
                        <div style="font-size: 0.9rem; margin-top: 4px;">${body}</div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
    </script>
    <script defer src="js/theme.js"></script>
    <script defer src="js/notifications.js"></script>
    <script defer src="js/admin-dashboard.js"></script>
</body>
</html>